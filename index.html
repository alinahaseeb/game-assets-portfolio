<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Your Name — Game Art</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="/styles.css"/>
  </head>
  <body>
    <header class="nav">
      <a class="brand" href="/">Your Name</a>
      <nav>
        <a href="/" class="active">Production</a>
        <a href="/side-projects.html">Side Projects</a>
        <a href="/about.html">About</a>
        <a href="/resume.pdf" target="_blank" rel="noopener">Resume</a>
      </nav>
    </header>

    <main id="grid" class="grid"></main>

    <footer class="footer">
      <p>© <span id="year"></span> Your Name</p>
    </footer>

    <script>
      (async () => {
        const res = await fetch('/manifest.json', { cache: 'no-store' });
        const items = (await res.json()).filter(i => i.section === 'production');

        const isVideo = (url) => /\.mp4(\?|$)/i.test(url || '');
        const grid = document.getElementById('grid');

        grid.innerHTML = items.map(i => {
          const media = isVideo(i.posterSrc)
            ? `
              <video class="card-video" muted preload="metadata" playsinline
                    onmouseenter="this.currentTime=0; this.play()"
                    onmouseleave="this.pause(); this.currentTime=0;">
                <source src="${i.posterSrc}" type="video/mp4">
              </video>`
            : `<img loading="lazy" alt="${i.title}" src="${i.posterSrc}">`;

          return `
            <a class="card" href="/project.html?slug=${encodeURIComponent(i.slug)}">
              ${media}
              <div class="card-meta">
                <h3>${i.title}</h3>
                <p>${[i.client,i.year].filter(Boolean).join(' · ')}</p>
              </div>
            </a>`;
        }).join('');

        // Optional: cap preview to 5s while hovering
        grid.querySelectorAll('.card-video').forEach(v => {
          v.addEventListener('timeupdate', () => { if (v.currentTime >= 5) v.pause(); }, { passive:true });
        });
      })();
    </script>

  </body>
</html>